#!/bin/bash

# ================================
# GUIA DE DEPLOY - SMARTLEAD
# ================================

echo "ğŸ“‹ GUIA DE DEPLOY - SmartLead"
echo "================================"
echo ""

echo "1ï¸âƒ£ PREPARAÃ‡ÃƒO DO SERVIDOR"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "â€¢ Ubuntu 20.04 LTS ou superior"
echo "â€¢ Docker & Docker Compose instalados"
echo "â€¢ Portas 80, 443 abertas"
echo "â€¢ DomÃ­nio smartlead.jeansilva.dev.br apontando para o servidor"
echo ""

echo "2ï¸âƒ£ COMANDOS DE INSTALAÃ‡ÃƒO NO SERVIDOR"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "# Atualizar sistema"
echo "sudo apt update && sudo apt upgrade -y"
echo ""
echo "# Instalar Docker"
echo "curl -fsSL https://get.docker.com -o get-docker.sh"
echo "sudo sh get-docker.sh"
echo "sudo usermod -aG docker \$USER"
echo ""
echo "# Instalar Docker Compose"
echo "sudo curl -L \"https://github.com/docker/compose/releases/download/v2.21.0/docker-compose-\$(uname -s)-\$(uname -m)\" -o /usr/local/bin/docker-compose"
echo "sudo chmod +x /usr/local/bin/docker-compose"
echo ""
echo "# Instalar Make"
echo "sudo apt install make -y"
echo ""

echo "3ï¸âƒ£ DEPLOY DA APLICAÃ‡ÃƒO"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "# 1. Clone o repositÃ³rio"
echo "git clone <SEU_REPOSITORIO> smartlead"
echo "cd smartlead"
echo ""
echo "# 2. Configure as variÃ¡veis de produÃ§Ã£o"
echo "cp .env.prod.example .env.prod"
echo "nano .env.prod  # Configure suas senhas e chaves"
echo ""
echo "# 3. Execute o deploy"
echo "make deploy"
echo ""

echo "4ï¸âƒ£ CONFIGURAÃ‡Ã•ES IMPORTANTES"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "ğŸ“ ARQUIVO .env.prod (Configure antes do deploy):"
echo ""
echo "DB_PASSWORD=SuaSenhaMySQLSegura123!"
echo "MYSQL_ROOT_PASSWORD=SuaSenhaRootSegura123!"
echo "APP_KEY=base64:GeradoAutomaticamente"
echo "JWT_SECRET=SuaChaveJWTSegura123"
echo "APP_URL=https://smartlead.jeansilva.dev.br"
echo "VUE_APP_API_BASE_URL=https://smartlead.jeansilva.dev.br/api"
echo ""

echo "5ï¸âƒ£ COMANDOS ÃšTEIS PÃ“S-DEPLOY"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "# Ver logs da aplicaÃ§Ã£o"
echo "make logs"
echo ""
echo "# Acessar shell do backend"
echo "make shell"
echo ""
echo "# Backup do banco"
echo "docker-compose -f docker-compose.prod.yml exec db mysqldump -u root -p smartlead_db > backup_\$(date +%Y%m%d).sql"
echo ""
echo "# Atualizar aplicaÃ§Ã£o"
echo "git pull origin main && make deploy"
echo ""

echo "6ï¸âƒ£ URLS APÃ“S DEPLOY"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "ğŸŒ Frontend:     https://smartlead.jeansilva.dev.br"
echo "ğŸ”— API:          https://smartlead.jeansilva.dev.br/api"
echo "ğŸ“š Docs API:     https://smartlead.jeansilva.dev.br/api/documentation"
echo ""

echo "7ï¸âƒ£ TROUBLESHOOTING"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "âŒ Se der erro de permissÃ£o:"
echo "sudo chown -R \$USER:\$USER ."
echo "sudo chmod +x deploy.sh"
echo ""
echo "âŒ Se o SSL nÃ£o funcionar:"
echo "Verifique se o domÃ­nio estÃ¡ apontando corretamente"
echo "Aguarde atÃ© 24h para propagaÃ§Ã£o do DNS"
echo ""
echo "âŒ Se a aplicaÃ§Ã£o nÃ£o subir:"
echo "docker-compose -f docker-compose.prod.yml logs -f"
echo ""

echo "âœ… DEPLOY CONCLUÃDO!"
echo ""
echo "Acesse: https://smartlead.jeansilva.dev.br"
echo "Login padrÃ£o: admin@smartlead.com / password"
echo ""
echo "ğŸ“ Suporte: Verifique os logs com 'make logs'"
echo ""
echo "âš ï¸  IMPORTANTE - CONFIGURAÃ‡ÃƒO DE PORTAS"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "Como jÃ¡ existe um serviÃ§o na porta 3000, o SmartLead usarÃ¡:"
echo "â€¢ Porta 8080 para HTTP"
echo "â€¢ Porta 8443 para HTTPS"
echo ""
echo "Configure seu proxy reverso principal (nginx/cloudflare) para:"
echo "â€¢ smartlead.jeansilva.dev.br -> http://localhost:8080"
echo ""
echo "Exemplo de configuraÃ§Ã£o nginx do servidor:"
echo "server {"
echo "    listen 80;"
echo "    server_name smartlead.jeansilva.dev.br;"
echo "    location / {"
echo "        proxy_pass http://localhost:8080;"
echo "        proxy_set_header Host \$host;"
echo "        proxy_set_header X-Real-IP \$remote_addr;"
echo "        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;"
echo "        proxy_set_header X-Forwarded-Proto \$scheme;"
echo "    }"
echo "}"
